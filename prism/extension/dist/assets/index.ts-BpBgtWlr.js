(function(){const E=["article",'[role="main"]',"main",".article-body",".post-content",".entry-content",".content",".article-content","#content","#main",".story-body",".page-content"],h=new Set("script style noscript iframe svg math nav footer header aside form button".split(" "));function m(e=document){for(const o of E){const n=e.querySelector(o);if(n&&w(n)>100)return n}return null}function f(e,o=0){const n=[],t=o>0?o+256:0;function c(i){var s,T;if(t>0&&n.join(" ").length>=t)return;if(i.nodeType===Node.TEXT_NODE){const a=(s=i.textContent)==null?void 0:s.trim();a&&n.push(a);return}if(i.nodeType!==Node.ELEMENT_NODE)return;const l=(T=i.tagName)==null?void 0:T.toLowerCase();if(!(l&&h.has(l))){for(let a=0;a<i.childNodes.length;a++)if(c(i.childNodes[a]),t>0&&n.join(" ").length>=t)return;["p","br","div","li","h1","h2","h3","h4","blockquote"].includes(l||"")&&n.push(`
`)}}c(e);let r=n.join(" ").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim();return o>0&&r.length>o&&(r=r.slice(0,o)+"..."),r}function w(e){const o=e.cloneNode(!0);for(const n of h)for(const t of o.querySelectorAll(n))t.remove();return(o.textContent||"").trim().length}const u=12e3,d=50,y='[data-testid="tweetText"]',p='article[data-testid="tweet"]',N=['[data-testid="post-content"]','[slot="full-post-content"]',".Post .UserPost",'[data-click-id="text"]'];function _(e){var c,r;const o=((r=(c=e.defaultView)==null?void 0:c.location)==null?void 0:r.hostname)??window.location.hostname;if(!/^(x\.com|twitter\.com)$/.test(o))return"";const n=e.querySelector(y);if(n)return f(n,u);const t=e.querySelector(p);return t?f(t,u):""}function g(e){var n,t;const o=((t=(n=e.defaultView)==null?void 0:n.location)==null?void 0:t.hostname)??window.location.hostname;if(!/^((?:www\.)?reddit\.com)$/.test(o))return"";for(const c of N){const r=e.querySelector(c);if(r){const i=f(r,u);if(i.length>=d)return i}}return""}function S(e=document){var c,r,i,l;const o=((r=(c=e.defaultView)==null?void 0:c.location)==null?void 0:r.href)??window.location.href,n=e.title||"Untitled";let t=_(e)||g(e);if(t.length<d){const s=m(e);t=s?f(s,u):""}if(t.length<d){const s=e.body;t=s?f(s,u):""}return t.length<d&&(t=((l=(i=e.body)==null?void 0:i.innerText)==null?void 0:l.slice(0,u))||n),{url:o,title:n,text:t}}chrome.runtime.onMessage.addListener((e,o,n)=>{if((e==null?void 0:e.type)==="EXTRACT"){try{const t=S(document);n({ok:!0,data:t})}catch(t){n({ok:!1,error:t instanceof Error?t.message:"Extraction failed"})}return!0}});
})()
